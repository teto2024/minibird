# 文明育成ゲーム 完全仕様書

## 概要

文明育成ゲームは、Home Quest風のゲームシステムで、プレイヤーがコインを投資して資源を生産し、建物を建設し、研究を進めて文明を発展させるゲームです。

## ゲームの流れ

1. **コイン投資** → 研究ポイントと基本資源を獲得
2. **資源生産** → 建物が時間経過で自動的に資源を生産
3. **建物建設** → 資源を消費して新しい建物を建設
4. **研究** → 研究ポイントを使って新技術を開発
5. **時代進化** → 条件を満たすと次の時代に進化
6. **戦争** → 他プレイヤーを攻撃して資源を略奪

## 投資システム

- **投資比率**: 10コイン = 1研究ポイント + 基本資源ボーナス
- 投資すると研究ポイントと基本資源（食料、木材、石材）が増加

## 時代システム

### 1. 石器時代 (🪨)
- **アンロック条件**: 最初から利用可能
- **必要人口**: 0
- **必要研究ポイント**: 0
- **説明**: 文明の夜明け。狩猟と採集で生き延びる。

### 2. 青銅器時代 (🔶)
- **アンロック条件**: 人口50、研究ポイント100
- **説明**: 金属の発見。農業と貿易が始まる。

### 3. 鉄器時代 (⚔️)
- **アンロック条件**: 人口200、研究ポイント500
- **説明**: 鉄の力で領土を広げる。

### 4. 中世 (🏰)
- **アンロック条件**: 人口500、研究ポイント1500
- **説明**: 城と騎士の時代。封建制度が栄える。

### 5. ルネサンス (🎨)
- **アンロック条件**: 人口1000、研究ポイント4000
- **説明**: 芸術と科学の復興。大航海時代の幕開け。

### 6. 産業革命 (🏭)
- **アンロック条件**: 人口2500、研究ポイント10000
- **説明**: 機械の力で世界を変える。

### 7. 現代 (🌆)
- **アンロック条件**: 人口5000、研究ポイント25000
- **説明**: 情報と技術の時代。

## 資源システム

### 基本資源（石器時代から利用可能）
1. **食料** (🍖) - 住民を養う基本資源
2. **木材** (🪵) - 建設に必要な基本資源
3. **石材** (🪨) - 頑丈な建物に必要

### 青銅器時代の資源
4. **青銅** (🔶) - 道具と武器の素材
5. **布** (🧵) - 服や帆に使用
6. **薬草** (🌿) - 治療薬の原料 ⚠️
7. **包帯** (🩹) - 基本的な治療材料

### 鉄器時代の資源
8. **鉄** (⚙️) - 強力な武器と建物に必要
9. **馬** (🐴) - 騎兵と輸送に使用
10. **硫黄** (🔶) - 火薬と爆発物に使用

### 中世の資源
11. **金** (💰) - 貿易と高級品に使用
12. **大理石** (🏛️) - 高級建築に使用
13. **ガラス** (🔮) - 窓と科学機器に使用 ⚠️
14. **石炭** (⬛) - 産業と鍛冶に使用
15. **医薬品** (💊) - 負傷兵の治療に使用

### ルネサンス以降の資源
16. **知識** (📚) - 研究と発展に必要
17. **宝石** (💎) - 装飾品と高級品に使用
18. **香辛料** (🌶️) - 貿易と食品保存に使用
19. **鋼鉄** (⚙️) - 高品質な武器と防具に使用
20. **火薬** (💥) - 火器と爆発物に使用

### 産業革命の資源
21. **石油** (🛢️) - 産業と軍事に必要
22. **ゴム** (⚫) - 近代的な装備に使用

### 現代の資源
23. **クリスタル** (💎) - 高度な技術に必要
24. **電子部品** (🔌) - 現代技術に必要
25. **マナ** (✨) - 魔法の力の源
26. **チタン** (🔩) - 軽量で強靭な金属
27. **ウラン** (☢️) - 核技術に必要な資源
28. **ダイヤモンド** (💠) - 最高級の資源

### ⚠️ 修正済みの問題

**問題1: 薬草が生産できない（修正済み）**
- **影響する時代**: 青銅器時代以降
- **原因**: 薬草園 (herb_garden) の `produces_resource_id` が NULL に設定されていた
- **修正**: 薬草を1時間あたり8個生産するように設定
- **適用方法**: `fix_resource_production.sql` を実行

**問題2: ガラスが生産できない（修正済み）**
- **影響する時代**: 中世以降
- **原因**: ガラス工房 (glassworks) の `produces_resource_id` が NULL に設定されていた
- **修正**: ガラスを1時間あたり4個生産するように設定
- **適用方法**: `fix_resource_production.sql` を実行

**その他の修正**: 布、クリスタル、医薬品、鋼鉄、火薬、電子部品も同様に修正

## 建物システム

### 建物カテゴリ
1. **production** - 資源生産施設
2. **housing** - 住居（人口を増やす）
3. **military** - 軍事施設（軍事力を増やす）
4. **research** - 研究施設（知識を生産）
5. **special** - 特殊施設（その他の効果）

### 石器時代の建物
- **小屋** (🛖) - 住民が住む基本的な住居（人口+5）
- **狩場** (🏹) - 食料を生産（10/時）
- **採石場** (⛏️) - 石材を採掘（8/時）
- **伐採場** (🪓) - 木材を生産（12/時）

### 青銅器時代の建物
- **農場** (🌾) - 食料を効率的に生産（25/時）
- **青銅鋳造所** (🔥) - 青銅を生産（5/時）
- **家** (🏠) - より多くの住民が住める（人口+15）
- **兵舎** (⚔️) - 兵士を訓練する（軍事力+20）
- **織物工場** (🧵) - 布を生産（6/時）
- **薬草園** (🌿) - 薬草を栽培（8/時）
- **穀倉** (🌾) - 食料の保存と生産（15/時）
- **村落** (🏘️) - 複数の家族が住む集落（人口+25）
- **監視塔** (🗼) - 早期警戒と防御（軍事力+10）
- **弓術場** (🏹) - 弓兵を訓練（軍事力+15）
- **記念碑** (🗿) - 文明の象徴（人口+5）

### 鉄器時代の建物
- **鉄鉱山** (⛏️) - 鉄を採掘（4/時）
- **鍛冶場** (🔨) - 武器と道具を作る（軍事力+10）
- **要塞** (🏯) - 防御力と軍事力を上げる（軍事力+50）
- **邸宅** (🏛️) - 多くの住民と贅沢な生活（人口+30）
- **坑道** (⛏️) - 深い鉱山で鉄を採掘（6/時）
- **厩舎** (🐴) - 騎兵を訓練（軍事力+30）
- **製材所** (🪚) - 木材を効率的に生産（20/時）
- **写本室** (📜) - 知識の保存と複製（3/時）
- **港** (⚓) - 海上貿易と海軍基地（軍事力+20）
- **神殿** (🛕) - 文化と信仰の中心（人口+10）

### 中世の建物
- **城** (🏰) - 王国の象徴（人口+50、軍事力+200）
- **金鉱山** (💰) - 金を採掘（2/時）
- **図書館** (📚) - 知識を蓄積（5/時）
- **大聖堂** (⛪) - 人々の心を豊かにする
- **ガラス工房** (🔮) - ガラスを生産（4/時）
- **造幣局** (🪙) - 金をコインに変換（0.5/時）
- **武器庫** (⚔️) - 武器の保管と製造（軍事力+25）
- **町** (🏙️) - 発展した居住区（人口+80、軍事力+10）
- **調剤所** (⚗️) - 医薬品を製造（3/時）
- **天文台** (🔭) - 天体観測と科学研究（8/時）
- **市場** (🏪) - 資源の交換ができる
- **銀行** (🏦) - コインを増やす（1/時）
- **劇場** (🎭) - 文化と娯楽の中心（人口+20）
- **闘技場** (🏟️) - 大規模な娯楽施設（人口+30、軍事力+20）
- **攻城兵器工房** (⚙️) - 攻城兵器を製造（軍事力+80）

### ルネサンスの建物
- **大学** (🎓) - 研究効率を上げる（15/時）
- **研究所** (🔬) - 科学的研究を行う（12/時）
- **製鋼所** (🏭) - 鋼鉄を生産（3/時）
- **火薬工場** (💥) - 火薬を製造（2/時）
- **士官学校** (🎖️) - 上級軍人の訓練（軍事力+150）
- **アカデミー** (🎓) - 高度な研究を行う（10/時）
- **大使館** (🏛️) - 外交と同盟の拠点
- **造船所** (⚓) - 海軍を建造（軍事力+100）
- **風車** (🌬️) - 効率的に穀物を生産（35/時）

### 産業革命の建物
- **工場** (🏭) - 大量生産を可能にする
- **軍事基地** (🎖️) - 最強の軍事施設（軍事力+500）
- **油井** (🛢️) - 石油を採掘（3/時）
- **大都市** (🌆) - 巨大な都市（人口+200、軍事力+50）

### 現代の建物
- **クリスタル鉱山** (💎) - クリスタルを採掘（1/時）
- **アパートメント** (🏢) - 現代的な集合住宅（人口+100）
- **空軍基地** (✈️) - 航空機を配備（軍事力+1000）
- **電子部品工場** (🔌) - 電子部品を製造（1.5/時）
- **シンクタンク** (🧠) - 戦略的研究機関（20/時）
- **核サイロ** (☢️) - 究極の抑止力（軍事力+5000）
- **宇宙港** (🚀) - 宇宙開発の拠点

### 世界の驚異（ワンダー）
- **ピラミッド** (🔺) - 古代の驚異（青銅器時代）
- **コロセウム** (🏟️) - 娯楽の殿堂（鉄器時代）
- **万里の長城** (🧱) - 究極の防御施設（中世、軍事力+500）

### 出撃上限アップ建物（軍事カテゴリ）

出撃時に出せる兵士数には上限があり、以下の建物を建設・アップグレードすることで上限を増やせます。
基本上限は100人で、建物のレベルに応じてボーナスが加算されます。

| 建物名 | アイコン | 解放時代 | 上限ボーナス/レベル | 説明 |
|--------|----------|----------|---------------------|------|
| 司令部 | 🏛️ | 青銅器時代 | +50 | 兵士の指揮統制を行う施設 |
| 軍事センター | 🎪 | 鉄器時代 | +100 | 大規模な軍事訓練・指揮施設 |
| 戦略本部 | 🗺️ | 中世 | +200 | 軍事戦略を立案・指揮する最高司令部 |
| 総司令部 | ⭐ | 産業革命 | +500 | 軍全体を統括する最高司令機関 |
| 兵舎 | ⚔️ | 青銅器時代 | +10 | 兵士を訓練する施設 |
| 要塞 | 🏯 | 鉄器時代 | +30 | 防御力と軍事力を上げる |
| 城 | 🏰 | 中世 | +50 | 王国の象徴 |
| 軍事基地 | 🎖️ | 産業革命 | +200 | 最強の軍事施設 |
| 空軍基地 | ✈️ | 現代 | +150 | 航空機を配備 |

**計算例**: 司令部Lv.5 + 軍事センターLv.3 の場合
- 基本上限: 100人
- 司令部ボーナス: 50 × 5 = 250人
- 軍事センターボーナス: 100 × 3 = 300人
- **合計出撃上限: 650人**

**注意**: ワールドボス戦では出撃上限は1000人で固定され、建物ボーナスは適用されません。

## 研究システム

### 石器時代の研究
1. **基本道具** (🔧) - 基本的な石器道具を作る
2. **火の利用** (🔥) - 火を使いこなす
3. **農業の基礎** (🌱) - 植物を育てる知識
4. **家畜の飼育** (🐄) - 動物を飼い慣らす
5. **土器** (🏺) - 容器を作る技術

### 青銅器時代の研究
6. **青銅加工** (🔶) - 青銅を加工する技術
7. **文字** (📜) - 情報を記録する
8. **軍事訓練** (⚔️) - 兵士を訓練する
9. **車輪** (🛞) - 輸送効率を上げる
10. **弓術** (🎯) - 弓矢の技術
11. **航海** (⛵) - 海を渡る技術

### 鉄器時代の研究
12. **鉄加工** (⚙️) - 鉄を加工する技術
13. **工学** (📐) - 建築と機械の知識
14. **哲学** (🤔) - 知恵を深める
15. **数学** (📐) - 計算と測量の技術
16. **医学** (💊) - 治療の技術
17. **通貨** (💰) - 貨幣経済を確立

### 中世の研究
18. **封建制度** (👑) - 領土を統治する
19. **銀行業** (🏦) - 金融システムを確立
20. **神学** (⛪) - 信仰を体系化する
21. **騎士道** (🏇) - 騎士の訓練
22. **建築学** (🏛️) - 高度な建築技術
23. **錬金術** (⚗️) - 物質変換の研究

### ルネサンスの研究
24. **科学的方法** (🔬) - 体系的な研究方法
25. **航海術** (🧭) - 海を渡る技術
26. **印刷機** (📰) - 知識の大量普及
27. **火薬** (💣) - 爆発物の技術
28. **天文学** (🔭) - 天体観測の科学

### 産業革命の研究
29. **蒸気機関** (🚂) - 蒸気の力を利用
30. **電気** (⚡) - 電気を利用する
31. **石油掘削** (🛢️) - 石油を採掘する技術
32. **大量生産** (🏭) - 製造効率を上げる
33. **航空技術** (✈️) - 空を飛ぶ技術
34. **鉄道** (🚂) - 大量輸送システム
35. **電信** (📡) - 長距離通信
36. **生物学** (🧬) - 生命の科学

### 現代の研究
37. **原子力** (☢️) - 核の力を利用
38. **コンピュータ** (💻) - デジタル技術
39. **インターネット** (🌐) - 世界をつなぐ
40. **ロケット工学** (🚀) - 宇宙への第一歩
41. **遺伝子工学** (🧬) - 生命の設計図を操作
42. **人工知能** (🤖) - 機械に知性を与える
43. **量子コンピューティング** (⚛️) - 次世代の計算技術

## 兵種システム

### 兵種カテゴリと相性
兵種には4つのカテゴリがあり、相性システムがあります：

- **歩兵** (🗡️) → 遠距離に強い、騎兵に弱い
- **騎兵** (🐴) → 歩兵に強い、遠距離に弱い
- **遠距離** (🏹) → 騎兵に強い、歩兵に弱い
- **攻城** (💣) → 歩兵に強い、騎兵に弱い

**相性ボーナス**:
- 有利な相手: +25%ダメージ
- 不利な相手: -25%ダメージ

### 石器時代の兵種
- **狩人** (🏹) - 基本的な遠距離兵（攻撃5、防御3）
- **戦士** (⚔️) - 基本的な近接兵（攻撃8、防御5）
- **斥候** (👁️) - 偵察ユニット（攻撃3、防御2）

### 青銅器時代の兵種
- **槍兵** (🗡️) - 騎兵に強い歩兵（攻撃10、防御8）
- **戦車** (🛞) - 高速突撃ユニット（攻撃15、防御6）
- **民兵** (👥) - 緊急招集兵（攻撃6、防御4）
- **ファランクス** (🛡️) - 密集陣形歩兵（攻撃12、防御15）

### 鉄器時代の兵種
- **剣士** (⚔️) - 強力な近接兵（攻撃20、防御15）
- **騎兵** (🐎) - 機動力の高い騎馬兵（攻撃25、防御12）
- **弓兵** (🏹) - 強化された遠距離兵（攻撃18、防御8）
- **長槍兵** (🗡️) - 騎兵対策歩兵（攻撃15、防御20）
- **戦象** (🐘) - 強力な突撃ユニット（攻撃45、防御35）

### 中世の兵種
- **騎士** (🛡️) - 重装騎兵（攻撃40、防御30）
- **クロスボウ兵** (🎯) - 強力な遠距離兵（攻撃30、防御15）
- **カタパルト** (🪨) - 攻城兵器（攻撃50、防御10）
- **長弓兵** (🏹) - 長射程の弓兵（攻撃35、防御10）
- **トレビュシェット** (🪨) - 強力な攻城兵器（攻撃70、防御5）
- **親衛隊** (👑) - 王を守る精鋭部隊（攻撃50、防御45）
- **狂戦士** (😤) - 圧倒的な攻撃力（攻撃70、防御15）

### ルネサンスの兵種
- **マスケット銃兵** (🔫) - 火器を使う歩兵（攻撃45、防御20）
- **大砲** (💣) - 強力な攻城兵器（攻撃80、防御15）
- **ガレオン船** (⛵) - 海上戦闘ユニット（攻撃60、防御40）
- **ライフル兵** (🔫) - 精密射撃歩兵（攻撃50、防御25）
- **竜騎兵** (🐎) - 騎乗射撃兵（攻撃55、防御30）
- **フリゲート艦** (⛵) - 高速軍艦（攻撃70、防御50）

### 産業革命の兵種
- **歩兵** (🎖️) - 近代歩兵（攻撃60、防御40）
- **砲兵** (💥) - 長距離砲撃ユニット（攻撃100、防御25）
- **装甲艦** (🚢) - 強力な海上ユニット（攻撃120、防御80）
- **海兵隊** (⚓) - 上陸作戦専門部隊（攻撃70、防御50）

### 現代の兵種
- **戦車** (🚜) - 強力な陸上ユニット（攻撃150、防御100）
- **戦闘機** (✈️) - 航空戦闘ユニット（攻撃180、防御50）
- **爆撃機** (💣) - 対地攻撃航空機（攻撃250、防御30）
- **潜水艦** (🚤) - ステルス海上ユニット（攻撃200、防御60）
- **空挺部隊** (🪂) - 空中降下部隊（攻撃90、防御40）
- **特殊部隊** (🎯) - エリート部隊（攻撃120、防御80）
- **ミサイル発射機** (🚀) - 長距離攻撃ユニット（攻撃200、防御20）
- **ステルス戦闘機** (✈️) - 見えない戦闘機（攻撃220、防御70）
- **航空母艦** (🚢) - 移動空軍基地（攻撃300、防御200）
- **原子力潜水艦** (🔱) - ステルス核戦力（攻撃350、防御150）

## 戦闘システム

### 軍事力の計算
総軍事力 = 建物の軍事力 + 兵士の戦力 + 装備の戦力

- **建物の軍事力**: 軍事系建物のレベル×軍事力
- **兵士の戦力**: (攻撃力 + 防御力/2 + 体力/50) × 兵数
- **装備の戦力**: 攻撃力バフ + 体力バフ/10

### 装備バフ
- **攻撃力バフ**: 直接戦闘力に加算
- **アーマーバフ**: 敵の攻撃を軽減（最大50%まで）
  - アーマー100 = 100/100 = 100%軽減（50%上限）
  - アーマー50 = 50/100 = 50%軽減
- **体力バフ**: 戦闘継続力に影響

### ターン制バトル
戦闘はターン制で進行します：

1. 両軍の初期HP = 基礎体力 + 装備体力バフ
2. 各ターンで攻撃側と防御側が交互に攻撃
3. ダメージ = (基礎攻撃力 + 装備攻撃力) × (1 - 敵のアーマー軽減率) × 相性倍率
4. いずれかのHPが0になるまで戦闘継続

### 兵士の特殊スキル
一部の兵種は特殊スキルを持ち、戦闘中に発動する可能性があります：

- **バフスキル**: 味方の能力を強化
- **デバフスキル**: 敵の能力を低下
- **継続ダメージ**: ターン終了時に追加ダメージ
- **即時ダメージ**: 発動時に即座にダメージ

### 勝利条件と略奪
- 敵のHPを0にすると勝利
- 勝利すると相手のコインの5%と資源の10%を略奪
- 攻撃側は1.1倍のボーナスを得る

### 負傷兵システム
- 戦闘で敗北すると兵士の30%が負傷、10%が戦死
- 負傷兵は病院で治療可能
- 治療には時間とコインが必要（基本治療時間: 30秒/兵士、コスト: 10コイン/兵士）

## 訓練・治療キューシステム

### 訓練キュー
- **基本キュー数**: 1
- **追加キュー**: 兵舎数 + 兵舎レベル合計/2
- 訓練には時間がかかる
- クリスタルやダイヤモンドで即完了可能

### 治療キュー
- **基本キュー数**: 1
- **追加キュー**: 病院数 + 病院レベル合計/2
- **病院容量**: 10床/病院 + 5床/レベル
- 治療には時間とコインが必要
- クリスタルやダイヤモンドで即完了可能

### 即完了コスト
- **クリスタル**: 60秒/個
- **ダイヤモンド**: 120秒/個（クリスタルより安い）
- 最低コスト: 訓練2個、治療1個

## 市場システム

資源を交換できる市場があります：

- 市場建物を建設すると利用可能
- 資源の価値に応じた交換レートで取引
- 市場建物のレベルに応じてレートが改善

### 資源価値（交換レート計算用）
1. 食料: 1.0
2. 木材: 1.0
3. 石材: 1.2
4. 布: 1.5
5. 青銅: 1.5
6. 馬: 2.0
7. 鉄: 2.0
8. 硫黄: 2.0
9. 石炭: 2.0
10. 大理石: 2.5
11. ガラス: 2.5
12. 知識: 2.5
13. 金: 3.0
14. 香辛料: 3.0
15. クリスタル: 4.0
16. 宝石: 4.0
17. マナ: 4.5
18. ウラン: 5.0
19. ダイヤモンド: 6.0

## VIPショップ

ダイヤモンドを使用して特殊なブーストを購入できます：

- **生産2倍ブースト**: 資源生産速度が2倍
- **研究速度ブースト**: 研究時間が短縮
- **建設速度ブースト**: 建設時間が短縮

## 占領戦システム

週次でリセットされる特殊コンテンツ：

- マップ上の城を攻め落とす
- 中央の神城を目指す
- 防御部隊を配置して城を守る
- 毎週月曜日にリセット

## ゲームバランス定数

- **攻撃側ボーナス**: 1.1倍
- **資源略奪率**: 10%
- **コイン略奪率**: 5%
- **アーマー最大軽減率**: 50%
- **兵種相性ボーナス**: ±25%
- **負傷兵発生率**: 30%
- **戦死率**: 10%

---

## 仕様変更履歴

### 2024年12月 - 資源生産の修正

**修正内容**:
1. ガラス工房がガラス資源を生産するように修正
2. 薬草園が薬草資源を生産するように修正

**修正理由**:
これらの建物は「生産施設」として定義されているにもかかわらず、データベース上で `produces_resource_id` が NULL に設定されており、実際には何も生産していませんでした。これは明らかな設計ミスであり、プレイヤーが意図した通りにゲームをプレイできない状態でした。

---

## 技術仕様

### データベーステーブル
- `civilization_eras` - 時代マスター
- `civilization_resource_types` - 資源タイプマスター
- `civilization_building_types` - 建物タイプマスター
- `civilization_researches` - 研究マスター
- `civilization_troop_types` - 兵種タイプマスター
- `user_civilizations` - ユーザー文明
- `user_civilization_resources` - ユーザー資源
- `user_civilization_buildings` - ユーザー建物
- `user_civilization_researches` - ユーザー研究進捗
- `user_civilization_troops` - ユーザー兵士
- `civilization_war_logs` - 戦争ログ
- `civilization_boosts` - ブースト

### API エンドポイント
- `civilization_api.php` - メインAPI
- `civilization.php` - フロントエンド

### 主要な関数
- `getUserCivilization()` - 文明取得
- `collectResources()` - 資源収集
- `calculateTotalMilitaryPower()` - 軍事力計算
- `calculateTroopAdvantageMultiplier()` - 相性計算

---

**最終更新**: 2024年12月29日
**バージョン**: 1.0
