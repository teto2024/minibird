# 占領戦マップ拡張ガイド

## 概要
占領戦のマップサイズは定数を変更するだけで簡単に拡張できます。

## マップサイズの変更方法

### 基本手順
`conquest_api.php` の定数を変更するだけです：

```php
define('CONQUEST_MAP_SIZE', 5);  // 現在: 5x5 (25城)
```

例：
- `5` → `7` に変更すると 7x7 (49城)
- `7` → `9` に変更すると 9x9 (81城)

### 推奨サイズ
- **奇数サイズを推奨**: 3, 5, 7, 9, 11 など
  - 理由: 中心に神城を配置するため
- **偶数サイズ**: 使用可能だが、中心が左上寄りになります

### マップ構造
マップは同心円状に生成されます：

```
現在 (5x5):
□□□□□  □ = 外周城 (outer) - 12城
□■■■□  ■ = 中間城 (middle) - 8城
□■◆■□  ◆ = 内周城 (inner) - 4城
□■■■□  ⛩ = 神城 (sacred) - 1城
□□□□□

7x7に拡張した場合:
□□□□□□□  □ = 外周城 (outer) - 24城
□■■■■■□  ■ = 中間城 (middle) - 16城
□■●●●■□  ● = 中間城内側 (middle) - 8城
□■●◆●■□  ◆ = 内周城 (inner) - 4城
□■●●●■□  ⛩ = 神城 (sacred) - 1城
□■■■■■□
□□□□□□□
```

## 自動的に調整される要素

### ✅ 自動調整される要素
以下は定数変更だけで自動的に対応されます：

1. **城の配置**
   - 中心座標の計算: `floor($size / 2)`
   - 同心円状の配置
   - 城の種類判定（外周、中間、内周、神城）

2. **隣接関係**
   - 上下左右＋斜めの8方向
   - 座標に基づいて自動計算

3. **地形タイプ**
   - 外周: 位置に応じた地形
   - 中間: 川
   - 内周: 要塞
   - 神城: 要塞

4. **NPC防御力**
   - 外周: CONQUEST_NPC_BASE_POWER (100)
   - 中間: CONQUEST_NPC_BASE_POWER × 2 (200)
   - 内周: CONQUEST_NPC_BASE_POWER × 3 (300)
   - 神城: CONQUEST_SACRED_NPC_POWER (5000)

5. **耐久度**
   - 外周: 500
   - 中間: 1000
   - 内周: 2000
   - 神城: 5000

6. **フロントエンド表示**
   - グリッドレイアウトが自動調整
   - `grid-template-columns: repeat(${mapSize}, 1fr)`

## 考慮すべき点

### 🔍 検討が必要な要素

1. **城の名前のバリエーション**
   現在の名前配列：
   ```php
   'outer' => ['辺境の砦', '前哨基地', '守りの塔', '見張りの城', '境界の城'],  // 5種類
   'middle' => ['中央砦', '堅牢城', '戦略拠点', '守護の城'],                    // 4種類
   'inner' => ['王城', '要塞', '大城塞', '内城'],                              // 4種類
   ```
   
   - 5x5 (25城): 十分
   - 7x7 (49城): 同じ名前が複数現れる
   - 9x9 (81城): さらに重複が増える
   
   **対応案**: より多くの名前を追加するか、座標を含めた名前にする

2. **パフォーマンス**
   - 5x5 (25城): 軽量
   - 7x7 (49城): 問題なし
   - 9x9 (81城): 問題なし
   - 11x11 (121城) 以上: データベースクエリとフロントエンド描画の負荷をテスト推奨

3. **ゲームバランス**
   - マップが大きいほど占領に時間がかかる
   - 外周城の数が増える = 参加プレイヤー数が増やせる
   - 神城到達までの距離が長くなる
   
   **推奨**: 段階的に拡張（5→7→9）してバランスを調整

4. **UI/UX**
   - 大きなマップはモバイル画面で見づらい可能性
   - 現在のレスポンシブデザインで対応済みだが、9x9以上は要確認

5. **シーズン期間**
   現在: 7日間
   ```php
   define('CONQUEST_SEASON_DURATION_DAYS', 7);
   ```
   
   - マップが大きくなる場合、シーズン期間の延長を検討
   - 例: 7x7 → 10日、9x9 → 14日

## 拡張の推奨手順

### ステップ1: テスト環境で確認
```php
// conquest_api.php
define('CONQUEST_MAP_SIZE', 7);  // 5から7に変更
```

### ステップ2: 新シーズンから適用
- 既存シーズン中の変更は推奨されません
- 管理者機能でシーズンをリセットしてから適用

### ステップ3: ゲームバランスの調整（必要に応じて）
```php
// シーズン期間を延長
define('CONQUEST_SEASON_DURATION_DAYS', 10);

// 基本NPC防御力を調整
define('CONQUEST_NPC_BASE_POWER', 150);
```

### ステップ4: 城の名前を追加（オプション）
```php
// generateConquestMap() 関数内
$names = [
    'outer' => [
        '辺境の砦', '前哨基地', '守りの塔', '見張りの城', '境界の城',
        '北の砦', '南の砦', '東の砦', '西の砦', '辺境警備所'  // 追加
    ],
    'middle' => [
        '中央砦', '堅牢城', '戦略拠点', '守護の城',
        '要衝の城', '中核拠点', '防衛城', '鉄壁の城'  // 追加
    ],
    // ...
];
```

## まとめ

### ✅ 答え: はい、定数を変えるだけで拡張可能です

**最小限の変更で拡張可能**:
```php
define('CONQUEST_MAP_SIZE', 7);  // この1行を変更するだけ
```

**推奨される追加調整**:
1. シーズン期間の延長（マップサイズに応じて）
2. 城の名前のバリエーション追加（重複を減らすため）
3. ゲームバランスのテストと調整

**注意点**:
- 奇数サイズを推奨（中心に神城）
- 既存シーズン中の変更は避ける
- 大幅な拡張（9x9以上）は段階的に

## サポートされるサイズ

| サイズ | 総城数 | 外周 | 中間 | 内周 | 神城 | 推奨度 | 備考 |
|--------|--------|------|------|------|------|--------|------|
| 3x3    | 9      | 8    | 0    | 0    | 1    | ⭐    | 小規模向け |
| 5x5    | 25     | 16   | 8    | 0    | 1    | ⭐⭐⭐ | 現在の設定 |
| 7x7    | 49     | 24   | 20   | 4    | 1    | ⭐⭐⭐ | 中規模向け |
| 9x9    | 81     | 32   | 40   | 8    | 1    | ⭐⭐   | 大規模向け |
| 11x11  | 121    | 40   | 72   | 8    | 1    | ⭐     | 要パフォーマンステスト |

※ 推奨度は実装の簡易性と推定パフォーマンスに基づく
